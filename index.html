<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Mi Amor üéÑ</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #b71c1c;
            --secondary: #1b5e20;
            --paper: #fdf5e6;
            --gold: #ffd700;
        }

        body {
            margin: 0; padding: 0; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: #050505;
            overflow: hidden;
            font-family: 'Great Vibes', cursive;
        }

        /* Efecto Chimenea: Resplandor naranja en los bordes */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 50%, rgba(255, 69, 0, 0.15) 100%);
            animation: flicker 3s infinite;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .snow-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 2;
        }

        /* Control de M√∫sica */
        #music-control {
            position: fixed; top: 20px; right: 20px; z-index: 10;
            background: rgba(255, 255, 255, 0.2);
            width: 45px; height: 45px;
            display: flex; justify-content: center; align-items: center;
            border-radius: 50%; cursor: pointer;
            font-size: 20px; border: 2px solid white;
            transition: transform 0.3s;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Contenedor Principal */
        .container {
            position: relative; z-index: 5;
            perspective: 1000px;
        }

        .envelope-wrapper {
            position: relative;
            width: 300px; height: 200px;
            background: var(--primary);
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            cursor: pointer;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Solapa */
        .envelope-wrapper::before {
            content: ""; position: absolute; z-index: 5;
            border-top: 110px solid #d32f2f;
            border-right: 150px solid transparent;
            border-left: 150px solid transparent;
            top: 0; transform-origin: top;
            transition: all 0.5s ease;
        }

        /* Cuerpo del sobre */
        .envelope-wrapper::after {
            content: ""; position: absolute; z-index: 4;
            border-left: 150px solid #e53935;
            border-right: 150px solid #e53935;
            border-bottom: 100px solid #c62828;
            bottom: 0;
        }

        /* La Carta */
        .letter {
            position: absolute; bottom: 5px; left: 5%;
            width: 90%; height: 180px;
            background: var(--paper);
            padding: 20px; box-sizing: border-box;
            text-align: center; border-radius: 5px;
            transition: all 0.8s ease;
            z-index: 3; overflow-y: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .letter h1 {
            font-family: 'Mountains of Christmas', cursive;
            color: var(--secondary); font-size: 1.4rem; margin: 0;
        }

        .letter p { font-size: 1.2rem; color: #333; margin: 10px 0; }

        .letter img {
            width: 100%; max-height: 150px; object-fit: cover;
            border: 5px solid white; border-radius: 2px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: opacity 0.5s ease;
        }

        .tap-hint { font-size: 0.7rem; color: #888; font-family: sans-serif; margin-top: 5px; }

        /* Sello de Coraz√≥n */
        .heart {
            position: absolute; top: 50%; left: 50%;
            width: 35px; height: 35px; background: var(--gold);
            z-index: 6; transform: translate(-50%, -50%) rotate(-45deg);
            transition: all 0.4s ease;
        }
        .heart::before, .heart::after {
            content: ""; position: absolute; width: 35px; height: 35px;
            background: var(--gold); border-radius: 50%;
        }
        .heart::before { top: -18px; left: 0; }
        .heart::after { left: 18px; top: 0; }

        /* ESTADOS ABIERTOS */
        .envelope-wrapper.open { transform: translateY(80px); }
        .envelope-wrapper.open::before { transform: rotateX(180deg); z-index: 2; }
        .envelope-wrapper.open .letter {
            transform: translateY(-200px);
            height: 320px; z-index: 4;
        }
        .envelope-wrapper.open .heart { opacity: 0; transform: translate(-50%, -50%) scale(0); }

        .instrucciones {
            position: absolute; bottom: -60px; width: 100%; text-align: center;
            color: white; font-family: sans-serif; font-size: 0.8rem;
            letter-spacing: 2px; animation: blink 2s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

    </style>
</head>
<body>

    <canvas class="snow-canvas" id="snowCanvas"></canvas>

    <div id="music-control" onclick="toggleMusic(event)">üéµ</div>
    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <div class="envelope-wrapper" id="envelope" onclick="openEnvelope()">
            <div class="heart"></div>
            <div class="letter" id="letter">
                <h1>¬°Feliz Navidad, Amor!</h1>
                <p>Eres mi momento favorito del d√≠a...</p>
                
                <img id="galeria" src="https://images.unsplash.com/photo-1511268011861-691ed210aae8?auto=format&fit=crop&q=80&w=400" onclick="cambiarFoto(event)">
                <p class="tap-hint">(Toca nuestra foto)</p>

                <p style="font-size: 1rem;">"En cada luz de este √°rbol, veo el brillo de tu sonrisa. Gracias por ser mi mejor regalo."</p>
                <div style="color:var(--primary); font-size: 1.5rem;">‚ú® ‚ù§Ô∏è ‚ú®</div>
            </div>
        </div>
        <div class="instrucciones">TOCA PARA ABRIR</div>
    </div>

    <script>
        // --- 1. CONFIGURACI√ìN DE FOTOS ---
        const fotos = [
            "https://images.unsplash.com/photo-1511268011861-691ed210aae8?auto=format&fit=crop&q=80&w=400",
            "https://images.unsplash.com/photo-1543589077-47d81606c1bf?auto=format&fit=crop&q=80&w=400",
            "https://images.unsplash.com/photo-1512389142860-9c449e58a543?auto=format&fit=crop&q=80&w=400"
        ];
        let fotoIndex = 0;

        function cambiarFoto(e) {
            e.stopPropagation(); // Evita que el sobre se cierre al tocar la foto
            fotoIndex = (fotoIndex + 1) % fotos.length;
            const img = document.getElementById('galeria');
            img.style.opacity = 0;
            setTimeout(() => {
                img.src = fotos[fotoIndex];
                img.style.opacity = 1;
            }, 400);
        }

        // --- 2. CONTROL DE APERTURA ---
        function openEnvelope() {
            const env = document.getElementById('envelope');
            env.classList.toggle('open');
            
            // Intenta reproducir m√∫sica al abrir por primera vez
            const music = document.getElementById('bgMusic');
            if(env.classList.contains('open') && music.paused) {
                toggleMusic(new Event('click'));
            }
        }

        // --- 3. CONTROL DE M√öSICA ---
        function toggleMusic(e) {
            e.stopPropagation();
            const music = document.getElementById('bgMusic');
            const btn = document.getElementById('music-control');
            if (music.paused) {
                music.play();
                btn.style.animation = "spin 3s linear infinite";
                btn.innerText = "üíø";
            } else {
                music.pause();
                btn.style.animation = "none";
                btn.innerText = "üéµ";
            }
        }

        // --- 4. SISTEMA DE NIEVE (CANVAS) ---
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height - canvas.height;
                this.size = Math.random() * 3 + 1;
                this.speed = Math.random() * 1 + 0.5;
                this.velX = Math.random() * 0.5 - 0.25;
            }
            update() {
                this.y += this.speed;
                this.x += this.velX;
                if (this.y > canvas.height) this.reset();
            }
            draw() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        for (let i = 0; i < 120; i++) particles.push(new Particle());

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // --- 5. PARALLAX SUTIL (Solo PC) ---
        document.addEventListener('mousemove', (e) => {
            if(window.innerWidth > 768) {
                const x = (window.innerWidth / 2 - e.pageX) / 30;
                const y = (window.innerHeight / 2 - e.pageY) / 30;
                document.getElementById('envelope').style.transform = `rotateX(${-y}deg) rotateY(${x}deg)`;
            }
        });
    </script>
</body>
</html>
